<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI í¬ìŠ¤í„° ìƒì„±ê¸° (Gemini + Imagen)</title>
    <style>
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
            padding: 20px;
            background-color: #f4f6f8;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }
        h1 {
            color: #1a1a1a;
            border-bottom: 2px solid #007bff;
            padding-bottom: 15px;
            margin-bottom: 30px;
            text-align: center;
        }
        label {
            display: block;
            margin-top: 15px;
            font-weight: 600;
            color: #444;
            margin-bottom: 5px;
        }
        input[type="text"], textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 15px;
            transition: border-color 0.2s;
        }
        input[type="text"]:focus, textarea:focus {
            border-color: #007bff;
            outline: none;
        }
        button {
            width: 100%;
            background-color: #007bff;
            color: white;
            padding: 15px;
            margin-top: 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            transition: background-color 0.2s;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        /* ê²°ê³¼ ì˜ì—­ ìŠ¤íƒ€ì¼ */
        #resultContainer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px dashed #ddd;
            display: none; /* ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€ */
            text-align: center;
        }
        
        #generatedImage {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            margin-bottom: 20px;
        }

        .prompt-box {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: left;
            font-size: 13px;
            color: #666;
            border: 1px solid #eee;
        }

        .required::after {
            content: " *";
            color: #e74c3c;
        }

        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #007bff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ¨ AI í¬ìŠ¤í„° ë””ìì´ë„ˆ</h1>
    <p style="text-align: center; color: #666; margin-bottom: 30px;">
  
    </p>

    <div id="posterForm">
        <label for="text" class="required">ë©”ì¸ ë¬¸êµ¬ / ì¹´í”¼</label>
        <input type="text" id="text" value="ì§€ê¸ˆ ê°€ì…í•˜ë©´ ì²« ë‹¬ 50% í• ì¸!" placeholder="í¬ìŠ¤í„°ì— ë“¤ì–´ê°ˆ í•µì‹¬ ë¬¸êµ¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>

        <label for="description">ìº í˜ì¸ ìƒì„¸ ì„¤ëª…</label>
        <textarea id="description" rows="3" placeholder="ì–´ë–¤ ìƒí’ˆì´ë‚˜ ì´ë²¤íŠ¸ì¸ê°€ìš”?">í—¬ìŠ¤ì¥ ì‹ ê·œ ì˜¤í”ˆ ê¸°ë…, 3ê°œì›” ë“±ë¡ ì‹œ ì²« ë‹¬ ìš”ê¸ˆ 50% í• ì¸ í”„ë¡œëª¨ì…˜ì…ë‹ˆë‹¤.</textarea>

        <label for="brand_tone">ë¸Œëœë“œ í†¤ & ë¬´ë“œ</label>
        <input type="text" id="brand_tone" value="í™œê¸°ì°¨ê³  ì—ë„ˆì§€ ë„˜ì¹˜ëŠ”, ê¹”ë”í•œ ëŠë‚Œ, 3D ì¼ëŸ¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼">

        <label for="target_audience">íƒ€ê²Ÿ ê³ ê°</label>
        <input type="text" id="target_audience" value="20~30ëŒ€ ì§ì¥ì¸">

        <label for="image_keywords">ì´ë¯¸ì§€ í‚¤ì›Œë“œ (ì‰¼í‘œ êµ¬ë¶„)</label>
        <input type="text" id="image_keywords" value="í—¬ìŠ¤ì¥, ìš´ë™í•˜ëŠ” ì‚¬ëŒ, ë°ì€ ë¶„ìœ„ê¸°, ë•€, íŒŒë€ìƒ‰ ë°°ê²½">
        
        <button id="generateButton" onclick="generatePosterImage()">âœ¨ í¬ìŠ¤í„° ìƒì„±í•˜ê¸°</button>
    </div>

    <div id="loadingIndicator" class="loader"></div>
    <p id="loadingText" style="text-align: center; display: none; color: #666;">AIê°€ ì—´ì‹¬íˆ ê·¸ë¦¼ì„ ê·¸ë¦¬ê³  ìˆìŠµë‹ˆë‹¤... (ì•½ 10ì´ˆ ì†Œìš”)</p>

    <div id="resultContainer">
        <h2 style="margin-bottom: 20px;">ğŸ‰ ìƒì„±ëœ í¬ìŠ¤í„°</h2>
        <img id="generatedImage" src="" alt="AIê°€ ìƒì„±í•œ í¬ìŠ¤í„°" />
        
        <div class="prompt-box">
            <strong>ğŸ’¡ Geminiê°€ ì‘ì„±í•œ í”„ë¡¬í”„íŠ¸ (ì°¸ê³ ìš©):</strong>
            <p id="promptUsedResult" style="margin-top: 5px; font-family: monospace;"></p>
        </div>
        
        <button onclick="downloadImage()" style="background-color: #28a745; margin-top: 15px;">ğŸ’¾ ì´ë¯¸ì§€ ì €ì¥í•˜ê¸°</button>
    </div>
</div>

<script>

    const SERVER_URL = 'https://e414bbac-a41e-431a-95c8-37e80ffa48ac-00-1p9b824eqx21u.pike.replit.dev'; 

    async function generatePosterImage() {
        const generateButton = document.getElementById('generateButton');
        const resultContainer = document.getElementById('resultContainer');
        const generatedImage = document.getElementById('generatedImage');
        const promptResult = document.getElementById('promptUsedResult');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const loadingText = document.getElementById('loadingText');
        
        // 1. ì…ë ¥ ê°’ ê²€ì¦
        const textValue = document.getElementById('text').value.trim();
        if (!textValue) {
            alert("ë©”ì¸ ë¬¸êµ¬ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤!");
            return;
        }

        // 2. UI ì´ˆê¸°í™” (ë¡œë”© ì‹œì‘)
        generateButton.disabled = true;
        resultContainer.style.display = 'none';
        loadingIndicator.style.display = 'block';
        loadingText.style.display = 'block';

        // í‚¤ì›Œë“œ ë¦¬ìŠ¤íŠ¸ ë³€í™˜
        const keywordsInput = document.getElementById('image_keywords').value;
        const keywordsList = keywordsInput 
            ? keywordsInput.split(',').map(k => k.trim()).filter(k => k.length > 0)
            : [];

        const requestData = {
            "text": textValue,
            "description": document.getElementById('description').value,
            "brand_tone": document.getElementById('brand_tone').value,
            "target_audience": document.getElementById('target_audience').value,
            "image_keywords": keywordsList
        };

        try {
            // 3. ë°±ì—”ë“œ ìš”ì²­ (/generate_poster_image)
            const response = await fetch(`${SERVER_URL}/generate_poster_image`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestData)
            });

            const data = await response.json();
            
            if (!response.ok) {
                throw new Error(data.detail || 'ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }

            // 4. ì„±ê³µ ì‹œ ì´ë¯¸ì§€ í‘œì‹œ
            // Base64 ë¬¸ìì—´ì„ srcì— ì£¼ì…
            generatedImage.src = `data:image/png;base64,${data.image_base64}`;
            promptResult.textContent = data.prompt_used; // ì‚¬ìš©ëœ í”„ë¡¬í”„íŠ¸ í‘œì‹œ

            resultContainer.style.display = 'block';

        } catch (error) {
            console.error('Error:', error);
            alert(`âŒ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${error.message}`);
        } finally {
            // 5. ë¡œë”© ì¢…ë£Œ
            generateButton.disabled = false;
            loadingIndicator.style.display = 'none';
            loadingText.style.display = 'none';
        }
    }

    function downloadImage() {
        const img = document.getElementById('generatedImage');
        const link = document.createElement('a');
        link.href = img.src;
        link.download = 'ai_poster.png';
        link.click();
    }
</script>

</body>
</html>


