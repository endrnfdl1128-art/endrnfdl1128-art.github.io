<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ìºë¦­í„° ìƒì„± - AI TRPG</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="header">
    <h1>ğŸ§™ ìºë¦­í„° ìƒì„±</h1>
    <p id="scenarioTitle">ëª¨í—˜ì„ í•¨ê»˜í•  ìºë¦­í„°ë¥¼ ë§Œë“œì„¸ìš”</p>
  </div>

  <div class="container">
    <div class="grid-2">
      <!-- ì™¼ìª½: ìºë¦­í„° ì •ë³´ -->
      <div>
        <div class="card">
          <h2>ğŸ“ ê¸°ë³¸ ì •ë³´</h2>
          
          <div class="form-group">
            <label for="charName">ìºë¦­í„° ì´ë¦„ *</label>
            <input type="text" id="charName" placeholder="ìºë¦­í„°ì˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
          </div>

          <div class="form-group">
            <label for="charClass">ì§ì—…/ì—­í•  *</label>
            <input type="text" id="charClass" placeholder="ì˜ˆ: ì „ì‚¬, ë§ˆë²•ì‚¬, íƒì •, í•´ì»¤, ì˜ì‚¬">
          </div>

          <div class="form-group">
            <label for="charBackground">ë°°ê²½ ìŠ¤í† ë¦¬</label>
            <textarea id="charBackground" rows="4" placeholder="ìºë¦­í„°ì˜ ê³¼ê±°, ì„±ê²©, íŠ¹ì§• ë“±ì„ ììœ ë¡­ê²Œ ì‘ì„±í•˜ì„¸ìš”. AIê°€ ì´ë¥¼ ì°¸ê³ í•´ ì´ì•¼ê¸°ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤."></textarea>
          </div>
        </div>

        <div class="card">
          <h2>ğŸ’ ì‹œì‘ ì¥ë¹„</h2>
          <div class="form-group">
            <label for="startItems">ì†Œì§€í’ˆ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
            <input type="text" id="startItems" placeholder="ì˜ˆ: ê²€, ë°©íŒ¨, íšŒë³µ ë¬¼ì•½">
          </div>
          <p class="text-muted" style="font-size: 0.9rem;">
            ì‹œë‚˜ë¦¬ì˜¤ì— ë§ëŠ” ì¥ë¹„ë¥¼ ì„¤ì •í•˜ì„¸ìš”. ë¹„ì›Œë‘ë©´ ê¸°ë³¸ ì¥ë¹„ê°€ ì§€ê¸‰ë©ë‹ˆë‹¤.
          </p>
        </div>
      </div>

      <!-- ì˜¤ë¥¸ìª½: ìŠ¤íƒ¯ -->
      <div>
        <div class="card">
          <h2>ğŸ“Š ìŠ¤íƒ¯ ë°°ë¶„</h2>
          
          <div class="stat-points">
            <p>ë‚¨ì€ í¬ì¸íŠ¸</p>
            <div class="number" id="remainingPoints">20</div>
          </div>

          <div class="stat-input">
            <label>ğŸ’ª í˜ (Strength)</label>
            <div>
              <button onclick="adjustStat('strength', -1)">-</button>
              <input type="number" id="stat_strength" value="10" min="1" max="20" readonly>
              <button onclick="adjustStat('strength', 1)">+</button>
            </div>
          </div>
          <p class="text-muted" style="font-size: 0.8rem; margin-bottom: 16px;">ê·¼ì ‘ ì „íˆ¬, ë¬¼ê±´ ë“¤ê¸°, ë¬¸ ë¶€ìˆ˜ê¸°</p>

          <div class="stat-input">
            <label>ğŸƒ ë¯¼ì²© (Agility)</label>
            <div>
              <button onclick="adjustStat('agility', -1)">-</button>
              <input type="number" id="stat_agility" value="10" min="1" max="20" readonly>
              <button onclick="adjustStat('agility', 1)">+</button>
            </div>
          </div>
          <p class="text-muted" style="font-size: 0.8rem; margin-bottom: 16px;">íšŒí”¼, ì€ì‹ , ì •ë°€í•œ ë™ì‘</p>

          <div class="stat-input">
            <label>ğŸ§  ì§€ëŠ¥ (Intelligence)</label>
            <div>
              <button onclick="adjustStat('intelligence', -1)">-</button>
              <input type="number" id="stat_intelligence" value="10" min="1" max="20" readonly>
              <button onclick="adjustStat('intelligence', 1)">+</button>
            </div>
          </div>
          <p class="text-muted" style="font-size: 0.8rem; margin-bottom: 16px;">ì§€ì‹, ë§ˆë²•, ê¸°ê³„ ì¡°ì‘, ì¶”ë¦¬</p>

          <div class="stat-input">
            <label>ğŸ€ í–‰ìš´ (Luck)</label>
            <div>
              <button onclick="adjustStat('luck', -1)">-</button>
              <input type="number" id="stat_luck" value="10" min="1" max="20" readonly>
              <button onclick="adjustStat('luck', 1)">+</button>
            </div>
          </div>
          <p class="text-muted" style="font-size: 0.8rem; margin-bottom: 16px;">ìš°ì—°í•œ ë°œê²¬, ì¹˜ëª…íƒ€, ìœ„ê¸° íƒˆì¶œ</p>

          <button class="btn btn-secondary btn-block mt-20" onclick="resetStats()">ìŠ¤íƒ¯ ì´ˆê¸°í™”</button>
        </div>

        <!-- HP ì„¤ì • -->
        <div class="card">
          <h2>â¤ï¸ ì²´ë ¥ (HP)</h2>
          <div class="stat-input">
            <label>ìµœëŒ€ HP</label>
            <div>
              <button onclick="adjustHP(-10)">-</button>
              <input type="number" id="maxHP" value="100" min="50" max="200" readonly>
              <button onclick="adjustHP(10)">+</button>
            </div>
          </div>
          <p class="text-muted" style="font-size: 0.8rem;">50~200 ì‚¬ì´ë¡œ ì„¤ì •. ë†’ì„ìˆ˜ë¡ ìƒì¡´ë ¥ ì¦ê°€.</p>
        </div>
      </div>
    </div>

    <!-- ë²„íŠ¼ -->
    <div class="btn-group mt-20">
      <a href="scenario.html" class="btn btn-secondary">â† ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ</a>
      <button class="btn btn-primary btn-large" onclick="createCharacter()">âš”ï¸ ëª¨í—˜ ì‹œì‘!</button>
    </div>

    <!-- ê¸°ì¡´ ìºë¦­í„° -->
    <div class="card mt-20">
      <h2>ğŸ‘¥ ì €ì¥ëœ ìºë¦­í„°</h2>
      <div id="characterList">
        <!-- JSë¡œ ì±„ì›€ -->
      </div>
    </div>
  </div>

  <script src="js/storage.js"></script>
  <script>
    let scenarioId = null;
    let scenario = null;
    const BASE_STAT = 10;
    const TOTAL_POINTS = 20;

    // í˜ì´ì§€ ë¡œë“œ
    document.addEventListener('DOMContentLoaded', () => {
      // URLì—ì„œ ì‹œë‚˜ë¦¬ì˜¤ ID ê°€ì ¸ì˜¤ê¸°
      const params = new URLSearchParams(window.location.search);
      scenarioId = params.get('scenario');
      
      if (scenarioId) {
        scenario = Storage.getScenario(scenarioId);
        if (scenario) {
          document.getElementById('scenarioTitle').textContent = `ì‹œë‚˜ë¦¬ì˜¤: ${scenario.title}`;
        }
      }

      loadExistingCharacters();
      updatePoints();
    });

    // ìŠ¤íƒ¯ ì¡°ì ˆ
    function adjustStat(stat, delta) {
      const input = document.getElementById(`stat_${stat}`);
      const currentValue = parseInt(input.value);
      const newValue = currentValue + delta;
      
      // ë²”ìœ„ ì²´í¬
      if (newValue < 1 || newValue > 20) return;
      
      // í¬ì¸íŠ¸ ì²´í¬
      const pointsNeeded = delta > 0 ? delta : 0;
      const pointsReturned = delta < 0 ? -delta : 0;
      const remaining = getRemainingPoints();
      
      if (pointsNeeded > remaining) {
        alert('í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!');
        return;
      }
      
      input.value = newValue;
      updatePoints();
    }

    // HP ì¡°ì ˆ
    function adjustHP(delta) {
      const input = document.getElementById('maxHP');
      const newValue = parseInt(input.value) + delta;
      if (newValue >= 50 && newValue <= 200) {
        input.value = newValue;
      }
    }

    // ë‚¨ì€ í¬ì¸íŠ¸ ê³„ì‚°
    function getRemainingPoints() {
      const stats = ['strength', 'agility', 'intelligence', 'luck'];
      let used = 0;
      stats.forEach(stat => {
        const value = parseInt(document.getElementById(`stat_${stat}`).value);
        used += value - BASE_STAT;
      });
      return TOTAL_POINTS - used;
    }

    // í¬ì¸íŠ¸ í‘œì‹œ ì—…ë°ì´íŠ¸
    function updatePoints() {
      const remaining = getRemainingPoints();
      const display = document.getElementById('remainingPoints');
      display.textContent = remaining;
      display.style.color = remaining < 0 ? 'var(--danger)' : 'var(--accent)';
    }

    // ìŠ¤íƒ¯ ì´ˆê¸°í™”
    function resetStats() {
      ['strength', 'agility', 'intelligence', 'luck'].forEach(stat => {
        document.getElementById(`stat_${stat}`).value = BASE_STAT;
      });
      updatePoints();
    }

    // ìºë¦­í„° ìƒì„±
    function createCharacter() {
      const name = document.getElementById('charName').value.trim();
      const charClass = document.getElementById('charClass').value.trim();
      const background = document.getElementById('charBackground').value.trim();
      const itemsStr = document.getElementById('startItems').value.trim();
      
      // ìœ íš¨ì„± ê²€ì‚¬
      if (!name) {
        alert('ìºë¦­í„° ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      if (!charClass) {
        alert('ì§ì—…/ì—­í• ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      const remaining = getRemainingPoints();
      if (remaining < 0) {
        alert('ìŠ¤íƒ¯ í¬ì¸íŠ¸ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤!');
        return;
      }
      if (remaining > 0) {
        if (!confirm(`ì•„ì§ ${remaining} í¬ì¸íŠ¸ê°€ ë‚¨ì•˜ìŠµë‹ˆë‹¤. ê·¸ëŒ€ë¡œ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
          return;
        }
      }

      // ì‹œë‚˜ë¦¬ì˜¤ ì²´í¬
      if (!scenarioId || !scenario) {
        alert('ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.');
        window.location.href = 'scenario.html';
        return;
      }

      // ìºë¦­í„° ë°ì´í„° êµ¬ì„±
      const maxHP = parseInt(document.getElementById('maxHP').value);
      const items = itemsStr ? itemsStr.split(',').map(s => s.trim()).filter(s => s) : ['ê¸°ë³¸ ì¥ë¹„'];

      const character = {
        name,
        class: charClass,
        background: background || 'ì•Œë ¤ì§€ì§€ ì•Šì€ ê³¼ê±°ë¥¼ ê°€ì§„ ëª¨í—˜ê°€',
        stats: {
          hp: maxHP,
          maxHp: maxHP,
          strength: parseInt(document.getElementById('stat_strength').value),
          agility: parseInt(document.getElementById('stat_agility').value),
          intelligence: parseInt(document.getElementById('stat_intelligence').value),
          luck: parseInt(document.getElementById('stat_luck').value)
        },
        inventory: items
      };

      // ì €ì¥
      const saved = Storage.saveCharacter(character);

      // ê²Œì„ ì‹œì‘
      Storage.startNewGame(scenarioId, saved.id);
      window.location.href = 'game.html';
    }

    // ê¸°ì¡´ ìºë¦­í„° ë¡œë“œ
    function loadExistingCharacters() {
      const characters = Storage.getCharacters();
      const listDiv = document.getElementById('characterList');

      if (characters.length === 0) {
        listDiv.innerHTML = '<p class="text-muted">ì €ì¥ëœ ìºë¦­í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        return;
      }

      listDiv.innerHTML = characters.map(c => `
        <div class="save-item">
          <div class="save-info">
            <h4>${c.name}</h4>
            <p>${c.class} Â· HP ${c.stats?.maxHp || 100}</p>
          </div>
          <div class="save-actions">
            <button class="btn btn-primary" onclick="useCharacter('${c.id}')">ì„ íƒ</button>
            <button class="btn btn-secondary" onclick="deleteCharacter('${c.id}')">ì‚­ì œ</button>
          </div>
        </div>
      `).join('');
    }

    // ê¸°ì¡´ ìºë¦­í„° ì‚¬ìš©
    function useCharacter(charId) {
      if (!scenarioId || !scenario) {
        alert('ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.');
        window.location.href = 'scenario.html';
        return;
      }

      Storage.startNewGame(scenarioId, charId);
      window.location.href = 'game.html';
    }

    // ìºë¦­í„° ì‚­ì œ
    function deleteCharacter(id) {
      if (confirm('ì´ ìºë¦­í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        Storage.deleteCharacter(id);
        loadExistingCharacters();
      }
    }
  </script>

  <style>
    /* ìŠ¤íƒ¯ ì¡°ì ˆ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .stat-input button {
      width: 32px;
      height: 32px;
      border: 1px solid var(--border);
      background: var(--bg-secondary);
      color: var(--text-primary);
      border-radius: 4px;
      cursor: pointer;
      font-size: 1.2rem;
      transition: all 0.2s;
    }
    .stat-input button:hover {
      background: var(--accent);
      border-color: var(--accent);
    }
    .stat-input input[type="number"] {
      width: 50px;
      text-align: center;
      -moz-appearance: textfield;
      margin: 0 8px;
    }
    .stat-input input::-webkit-outer-spin-button,
    .stat-input input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    .stat-input > div {
      display: flex;
      align-items: center;
    }
  </style>
</body>
</html>
